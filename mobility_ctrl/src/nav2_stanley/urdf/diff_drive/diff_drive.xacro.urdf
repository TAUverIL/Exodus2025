<?xml version="1.0"?>
<robot name="diff_drive_rover" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- ───── common includes ───────────────────────────────────────────── -->
  <xacro:include filename="inertial_macros.xacro.urdf"/>
  <xacro:include filename="diff_gazebo.xacro.urdf"/>
  <xacro:include filename="lidar.xacro.urdf"/>

  <!-- ───── colours (unchanged) ───────────────────────────────────────── -->
  <material name="Black"><color rgba="0 0 0 1"/></material>
  <material name="Grey"><color rgba="0.8 0.8 0.8 1"/></material>
  <material name="Orange"><color rgba="1 0.6 0 1"/></material>
  <material name="White"><color rgba="1 1 1 1"/></material>
  <material name="Blue"><color rgba="0.2 0.2 1 1"/></material>
  <material name="Red"><color rgba="1 0.2 0.2 1"/></material>

  <!-- ───── parameters ────────────────────────────────────────────────── -->
  <xacro:property name="origin_xy"      value="0 0 0"/>
  <xacro:property name="origin_rpy"     value="0 0 0"/>
  <xacro:property name="chassis_length" value="2"/>
  <xacro:property name="chassis_width"  value="1"/>
  <xacro:property name="chassis_height" value="0.5"/>
  <xacro:property name="chassis_mass"   value="0.5"/>

  <xacro:property name="wheel_length"   value="0.08"/>
  <xacro:property name="wheel_radius"   value="0.3"/>
  <xacro:property name="wheel_mass"     value="11.3"/>
  <xacro:property name="wheel_offset_x" value="0.8"/>
  <xacro:property name="wheel_offset_y" value="0.5"/>
  <xacro:property name="wheel_offset_z" value="0.3"/>
  <xacro:property name="wheel_damping"  value="0.2"/>
  <xacro:property name="wheel_axis"     value="0 0 1"/>
  <xacro:property name="pi_div_2"       value="1.57"/>

  <!-- ───── main links ────────────────────────────────────────────────── -->
  <link name="base_link"/>
  <joint name="base_footprint_joint" type="fixed">
    <parent link="base_link"/><child link="base_footprint"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>
  <link name="base_footprint"/>

  <!-- Chassis -->
  <joint name="chassis_joint" type="fixed">
    <parent link="base_link"/><child link="chassis"/>
    <origin xyz="0 0 0.5" rpy="0 0 0"/>
  </joint>
  <link name="chassis">
    <visual><origin xyz="0 0 0.5"/><geometry>
      <box size="${chassis_length} ${chassis_width} ${chassis_height}"/>
    </geometry><material name="Orange"/></visual>
    <collision><origin xyz="0 0 ${chassis_height/2}"/><geometry>
      <box size="${chassis_length} ${chassis_width} ${chassis_height}"/>
    </geometry></collision>
    <xacro:inertial_box mass="${chassis_mass}"
                        x="${chassis_length}" y="${chassis_width}" z="${chassis_height}">
      <origin xyz="${chassis_length/2} 0 ${chassis_height/2}"/>
    </xacro:inertial_box>
  </link>

  <!-- ───── four drive wheels ──────────────────────────────────────────── -->
  <!-- front left -->
  <link name="front_left_wheel">
    <collision>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
    </collision>
    <visual>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
      <material name="Blue"/>
    </visual>
    <xacro:inertial_cylinder mass="${wheel_mass}"
                             length="${wheel_length}"
                             radius="${wheel_radius}">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </xacro:inertial_cylinder>
  </link>
  <joint name="front_left_wheel_joint" type="continuous">
    <parent link="chassis"/><child link="front_left_wheel"/>
    <origin xyz="-${wheel_offset_x} ${wheel_offset_y} ${wheel_offset_z}"
            rpy="-${pi_div_2} 0 0"/>
    <axis xyz="${wheel_axis}"/>
    <dynamics damping="${wheel_damping}"/>
  </joint>

  <!-- front right -->
  <link name="front_right_wheel">
    <collision>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
    </collision>
    <visual>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
      <material name="Blue"/>
    </visual>
    <xacro:inertial_cylinder mass="${wheel_mass}"
                             length="${wheel_length}"
                             radius="${wheel_radius}">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </xacro:inertial_cylinder>
  </link>
  <joint name="front_right_wheel_joint" type="continuous">
    <parent link="chassis"/><child link="front_right_wheel"/>
    <origin xyz="-${wheel_offset_x} -${wheel_offset_y} ${wheel_offset_z}"
            rpy="-${pi_div_2} 0 0"/>
    <axis xyz="${wheel_axis}"/>
    <dynamics damping="${wheel_damping}"/>
  </joint>

  <!-- rear left -->
  <link name="rear_left_wheel">
    <collision>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
    </collision>
    <visual>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
      <material name="Blue"/>
    </visual>
    <xacro:inertial_cylinder mass="${wheel_mass}"
                             length="${wheel_length}"
                             radius="${wheel_radius}">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </xacro:inertial_cylinder>
  </link>
  <joint name="rear_left_wheel_joint" type="continuous">
    <parent link="chassis"/><child link="rear_left_wheel"/>
    <origin xyz="${wheel_offset_x} ${wheel_offset_y} ${wheel_offset_z}"
            rpy="-${pi_div_2} 0 0"/>
    <axis xyz="${wheel_axis}"/>
    <dynamics damping="${wheel_damping}"/>
  </joint>

  <!-- rear right -->
  <link name="rear_right_wheel">
    <collision>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
    </collision>
    <visual>
      <geometry><cylinder length="${wheel_length}" radius="${wheel_radius}"/></geometry>
      <material name="Blue"/>
    </visual>
    <xacro:inertial_cylinder mass="${wheel_mass}"
                             length="${wheel_length}"
                             radius="${wheel_radius}">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </xacro:inertial_cylinder>
  </link>
  <joint name="rear_right_wheel_joint" type="continuous">
    <parent link="chassis"/><child link="rear_right_wheel"/>
    <origin xyz="${wheel_offset_x} -${wheel_offset_y} ${wheel_offset_z}"
            rpy="-${pi_div_2} 0 0"/>
    <axis xyz="${wheel_axis}"/>
    <dynamics damping="${wheel_damping}"/>
  </joint>

  <!-- ───── payloads (IMU, GPS, camera, LiDAR) left exactly as they were ─ -->
  <!-- (truncate here for brevity – copy your existing sensor blocks)       -->

  <!-- ───── ros2_control – diff drive plugin skeleton ──────────────────── -->
  <ros2_control name="IgnitionSystem" type="system">
    <hardware>
      <plugin>ign_ros2_control/IgnitionSystem</plugin>
    </hardware>

    <joint name="front_left_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface   name="position"/>
      <state_interface   name="velocity"/>
    </joint>
    <joint name="front_right_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface   name="position"/>
      <state_interface   name="velocity"/>
    </joint>

    <joint name="rear_left_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface   name="position"/>
      <state_interface   name="velocity"/>
    </joint>
    <joint name="rear_right_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface   name="position"/>
      <state_interface   name="velocity"/>
    </joint>

    <!-- DiffDriveController parameters will be loaded from YAML -->
  </ros2_control>

</robot>
